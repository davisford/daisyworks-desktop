<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx" 
		 creationComplete="onCreationComplete(event)"
		 resize="resizeHandler(event)"
		 width="100%" height="100%">
	<s:layout>
		<s:VerticalLayout paddingBottom="15"
						  paddingTop="15"
						  paddingLeft="15"
						  paddingRight="15"/>
	</s:layout>
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	
	<fx:Script>
		<![CDATA[
			import daisyworks.event.*;
			import daisyworks.model.*;
			
			import mx.controls.Alert;
			import mx.core.FlexGlobals;
			import mx.events.CloseEvent;
			import mx.events.FlexEvent;
			import mx.events.ResizeEvent;
			
			private var _prefs:Preferences;
			
			[Inject]
			public function get prefs():Preferences { return _prefs; }
			
			public function set prefs(val:Preferences):void {
				_prefs = val;
				FlexGlobals.topLevelApplication.height = _prefs.getValue(Preferences.HEIGHT, 470);
				FlexGlobals.topLevelApplication.width  = _prefs.getValue(Preferences.WIDTH, 1250);
			}
			
			public function onCreationComplete(event:FlexEvent):void {
				
			}
			
			[PostConstruct]
			/**
			 * Put stuff in here that should boot-strap the app
			 */
			public function go():void {
				if(_prefs.getValue(Preferences.JAVA_PATH) == null) {
					// hardcode it for now: we will ship JRE with installer
					_prefs.setValue(Preferences.JAVA_PATH, "/usr/bin/java");
				}
				// watchdog manages JVM lifecycle for us
				dispatchEvent(new Event("startWatchdog", true));
			}
			
			public function close():void {
				// tell the JVM to shutdown
				dispatchEvent(new Event("shutdownJVM", true));
				prefs.save();
			}
			
			private function resizeHandler(event:ResizeEvent):void {
				if(prefs) {
					prefs.setValue(Preferences.WIDTH, root.width);
					prefs.setValue(Preferences.HEIGHT, root.height);
				}
			}
			
			[EventHandler(event="DaisyWorksEvent.JVM_START_FAILURE", properties="message")]
			/**
			 * If Java can't be started
			 */
			public function javaFailed(message:String):void {
				Alert.show(message, "DaisyWorks encountered a problem and must now close.", 4, null, function(e:CloseEvent):void {
					NativeApplication.nativeApplication.exit(0);
				});
			}
			
			[EventHandler(event="DaisyWorksEvent.HTTP_404", properties="message")]
			/**
			 * What happens if JVM process starts, but we get 404 on AMF channel?
			 * This is most likely b/c another process is already bound to the port
			 */
			public function javaCommLost(message:String):void {
				Alert.show(message, "Please check the port settings", 4);
			}
			
		]]>
	</fx:Script>
	
	<fx:Declarations>
	</fx:Declarations>
	
	<s:Label text="HI THERE" />
</s:Group>