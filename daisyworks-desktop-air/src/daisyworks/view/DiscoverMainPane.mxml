<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx" width="100%" height="100%">
	<fx:Script>
		<![CDATA[
			import daisyworks.event.BluetoothTxRxEvent;
			import daisyworks.model.Icons;
			import daisyworks.model.Preferences;
			
			import mx.controls.Alert;
			import mx.events.ResizeEvent;
			import mx.messaging.events.MessageEvent;
			import mx.rpc.Fault;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			
			[Inject]
			public var prefs:Preferences;
			
			[Bindable]
			public var isConnected:Boolean = false;
			
			
			[EventHandler(event="BluetoothControlEvent.CONNECTED")]
			public function connected():void {
				isConnected=true;
			}
			
			[EventHandler(event="BluetoothControlEvent.DISCONNECTED")]
			public function disconnected():void {
				isConnected=false;
			}
			
			// _________________ TRANSMIT _________________ //
			
			protected function sendTI_keyDownHandler(event:KeyboardEvent):void {				
				if(event.keyCode == Keyboard.ENTER) {
					sendTextCommand(sendTI.text);
				}
			}
			
			protected function sendButton_clickHandler(event:MouseEvent):void {
				sendTextCommand(sendTI.text);
			}
						
			private function sendTextCommand(command:String):void {
				// clear TI
				sendTI.text = '';
				// append it to text area
				consoleTA.text += '\ntx> ' + command;
				// send it to the device
				if(crRadioGroup.selection == crOFF)
					dispatchEvent(new BluetoothTxRxEvent(BluetoothTxRxEvent.TX, command));
				else
					dispatchEvent(new BluetoothTxRxEvent(BluetoothTxRxEvent.TX, command+"\r"));
			}
			
			[EventHandler(event="BluetoothTxRxEvent.TX_FAULT", properties="fault")]
			public function sendFault(fault:Fault):void {
				consoleTA.text += '\ntx error> ' + fault.faultString;
			}
			
			// ___________________ RECEIVE ___________________ //

			[EventHandler(event="BluetoothTxRxEvent.RX", properties="data")]
			public function messageReceived(data:String):void {
				consoleTA.text += '\nrx> ' + data;
				scrollDown();
			}
				
			private function scrollDown(event:Event=null):void {
				// scroll with the text
				consoleTA.scroller.verticalScrollBar.value = consoleTA.scroller.verticalScrollBar.maximum + 100;
			}
			
			private const crToolTip:String = "Most commands will not need a trailing carriage return <CR>; however, some special debug modes do require it.  Use the radio button to toggle sending a carriage return or not.";

		]]>
	</fx:Script>
	<fx:Declarations>
		<s:RadioButtonGroup id="crRadioGroup"/>
	</fx:Declarations>
	<mx:TabNavigator id="tabNavigator" width="100%" height="100%">
		<mx:VBox label="Help" width="100%" height="100%">
			<s:Label text="Help goes here"/>
		</mx:VBox>
		<mx:VBox label="Serial Console" width="100%" height="100%" borderVisible="false">
		<s:Panel left="10" right="10" bottom="0" title="Serial Console" top="95" dropShadowVisible="false" width="100%" height="100%" borderVisible="false">
			<s:layout>
				<s:VerticalLayout gap="0"/>
			</s:layout>
			<s:HGroup height="30" verticalAlign="middle" width="100%" paddingLeft="10">
				<s:TextInput width="210" id="sendTI" keyDown="sendTI_keyDownHandler(event)" enabled="{isConnected}"/>
				<s:Button label="Send" id="sendButton" click="sendButton_clickHandler(event)" enabled="{isConnected}"/>
				<mx:VRule height="100%"/>
				<s:HGroup width="100%" height="100%" toolTip="{crToolTip}" verticalAlign="middle">
					<s:Label text="Carriage Return"/>
					<s:RadioButton id="crON" label="On" groupName="Carriage Return"/>
					<s:RadioButton id="crOFF" label="Off" groupName="Carriage Return" selected="true"/>
				</s:HGroup>
				<s:Label height="100%" verticalAlign="middle" width="100%" id="errorLabel"/>
			</s:HGroup>
			<s:TextArea width="100%" height="100%" id="consoleTA" editable="false" 
						enabled="true" verticalScrollPolicy="on" 
						valueCommit="scrollDown(event)"
						resize="scrollDown(event)" contentBackgroundColor="#E6E7E2" borderVisible="false"/>
		</s:Panel>
		</mx:VBox>
	</mx:TabNavigator>
	
	
</s:Group>
